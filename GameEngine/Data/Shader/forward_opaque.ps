#version 330

in vec2 texCoords;
in vec3 position;
in vec3 normal;

out vec4 finalColor;

uniform vec3 diffuseColor;
uniform sampler2D diffuseTexture;

uniform vec3 lightPositions[ 16 ];
uniform vec3 lightColors[ 16 ];
uniform float lightIntensities[ 16 ];
uniform float lightFalloffFactor[ 16 ];
uniform int lightCount;

void main()
{
    vec3 intensity = vec3( 0.0 );
    for( int i = 0; i < lightCount; ++i )
    {
        vec3 positionToLight = lightPositions[ i ] - position;
        float lightIntensity = lightIntensities[ i ] * ( 1.0 / ( 1.0 + lightFalloffFactor[ i ] * dot( positionToLight, positionToLight ) ) );

        vec3 lightDirection = normalize( lightPositions[ i ] - position );
        intensity += lightIntensity * max( dot( lightDirection, normalize( normal ) ), 0.0 ) * lightColors[ i ];
    }
    
    vec3 color = clamp( intensity * diffuseColor * texture( diffuseTexture, texCoords ).rgb, 0.0, 1.0 );
    finalColor = vec4( color, 1.0 );
}